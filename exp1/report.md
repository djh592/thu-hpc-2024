# MPI 异步通信小作业 实验报告

姓名：丁俊辉

学号：2021011145

## 任务一

InfiniBand:


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | -------- | --------- |
| 1    | 1        | 1.24     | 3.94      |
| 2    | 2        | 1.23     | 7.79      |
| 3    | 4        | 1.22     | 15.98     |
| 4    | 8        | 1.21     | 32.02     |
| 5    | 16       | 1.21     | 64.06     |
| 6    | 32       | 1.27     | 130.30    |
| 7    | 64       | 1.42     | 233.23    | 
| 8    | 128      | 1.51     | 352.54    |
| 9    | 256      | 2.38     | 509.75    |
| 10   | 512      | 2.46     | 1159.30   |
| 11   | 1024     | 2.84     | 1842.97   |
| 12   | 2048     | 3.49     | 2826.56   |
| 13   | 4096     | 7.97     | 3902.51   |
| 14   | 8192     | 10.55    | 4859.21   |
| 15   | 16384    | 13.18    | 5116.44   |
| 16   | 32768    | 17.23    | 10924.63  |
| 17   | 65536    | 23.36    | 11634.84  |
| 18   | 131072   | 36.31    | 11816.86  |
| 19   | 262144   | 52.74    | 11945.43  |
| 20   | 524288   | 83.73    | 12008.93  |
| 21   | 1048576  | 155.86   | 12039.73  |
| 22   | 2097152  | 291.69   | 12047.51  |
| 23   | 4194304  | 424.59   | 12059.59  |

以太网：


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | -------- | --------- |
| 1    | 1        | 47.71    | 0.29      |
| 2    | 2        | 46.17    | 0.58      |
| 3    | 4        | 47.14    | 1.17      |
| 4    | 8        | 47.17    | 2.30      |
| 5    | 16       | 47.24    | 4.77      |
| 6    | 32       | 47.55    | 8.69      |
| 7    | 64       | 48.60    | 15.52     |
| 8    | 128      | 50.24    | 32.57     |
| 9    | 256      | 55.11    | 52.63     |
| 10   | 512      | 60.59    | 78.68     |
| 11   | 1024     | 72.94    | 94.63     |
| 12   | 2048     | 90.77    | 104.35    |
| 13   | 4096     | 113.43   | 110.37    |
| 14   | 8192     | 195.89   | 113.87    |
| 15   | 16384    | 221.90   | 115.92    |
| 16   | 32768    | 366.80   | 116.79    |
| 17   | 65536    | 640.53   | 117.08    |
| 18   | 131072   | 1203.49  | 117.37    |
| 19   | 262144   | 2424.65  | 117.51    |
| 20   | 524288   | 4656.52  | 117.56    |
| 21   | 1048576  | 9105.31  | 117.60    |


- 请描述当消息长度增加时，带宽和延迟分别呈现出什么样的趋势？

消息长度倍增，延迟和带宽都呈现增长的趋势。

延迟的增速一开始较慢，之后趋近倍增；带宽一开始近似倍增，之后增速逐渐放缓。

- 该趋势在两种网络下有何不同？

在 InfiniBand 网络下，带宽增加速度更快，延迟增加较慢；而 Ethernet 网络下带宽增加速度较慢，延迟增加速度较快。

- 为什么会有这样的趋势？

带宽无法一直保持指数增长，InfiniBand 和 Ethernet 的带宽似乎都有一个“上限”，接近“上限”后带宽几乎不再增长，延迟近似翻倍。

InfiniBand 的“上限”明显更高，延迟增长就比 Ethernet 慢。

- 对比InfiniBand和以太网络下的带宽和延迟，它们之间的差距是多少？

InfiniBand 的带宽远远高于 Ethernet，延迟低很多，差距非常显著。

## 任务二

| 编号 | 消息长度  | 计算量 | mpi_sync 总耗时 | mpi_async  总耗时 |
| ---- | --------- | ------ | --------------- | ----------------- |
| 1    | 100000000 | 10     | 771.642 ms      | 669.919 ms        |
| 2    | 100000000 | 20     | 1072.74 ms      | 866.959 ms        |
| 3    | 100000000 | 40     | 1273.62 ms      | 869.208 ms        |
| 4    | 100000000 | 80     | 1682.55 ms      | 868.37 ms         |
| 5    | 100000000 | 160    | 2482.84 ms      | 1600.38 ms        |

- 通信时间和计算时间满足什么关系时，非阻塞通信程序能完美掩盖通信时间？

当计算时间大于通信时间时，非阻塞通信程序能完美掩盖通信时间。

- 简述两份代码的不同之处。

mpi_sync 使用 `MPI_Send` 进行阻塞式通信，必须等到消息被接收才能计算；而 mpi_async 使用 `MPI_Isend` 进行非阻塞式通信，发消息异步执行，并在之后使用 `MPI_Wait` 来等待通信操作完成。